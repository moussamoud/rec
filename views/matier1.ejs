<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Side Navigation Bar</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
</head>
<style>
  /* Styles pour le modal */
  .alert {
    position: fixed;
    top: 0;
    left: 0;
    width: 90%;
    padding: 1rem;
    margin-bottom: 0.5rem;
    border-radius: 12px;
    z-index: 9999;
  }

  /* Styles pour simuler un bouton avec une couleur verte */
  .button-like {
    display: inline-block;
    padding: 6px 12px;
    background-color: rgb(105, 52, 66);
    color: white;
    border: none;
    text-align: center;
    text-decoration: none;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s ease;
  }

  .button-like:hover {
    background-color: rgb(105, 52, 66);
  }

  .alert-success {
    background-color: #2D3250;
    color: #fff;
    border: 1px solid #c3e6cb;
  }

  .alert-info {
    background-color: #d1ecf1;
    color: #2D3250;
    border: 1px solid #bee5eb;
  }

  .alert-warning {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
  }

  .alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .alert-close {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    color: #af1515;
    text-decoration: none;
    font-weight: bold;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    width: 60%;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
  }

  .modal-body input[type="number"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .modal-body input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .modal-footer button {
    background-color: #2D4356;
    color: white;
    padding: 10px 20px;
    margin-left: 10px;
  }

  .modal-header h2 {
    margin: 0;
  }

  .modal-close {
    cursor: pointer;
  }

  .modal-body {
    margin-bottom: 10px;
  }

  .modal-footer {
    text-align: right;
  }

  .modal-footer button {
    padding: 10px 20px;
  }

  table.center {
    margin: 0 auto; /* Ajoutez cette ligne pour centrer la table horizontalement */
  }
  
  /* Ajoutez ces styles pour ajuster l'apparence de la table */
  table.center {
    width: 80%;
    border-collapse: collapse;
    margin: 20px auto; /* Ajustez la marge selon vos besoins */
  }
  
  th, td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ccc;
  }
  
  th {
    background-color: #2D3250;
    color: #fff;
  }
  

  /* Styles pour les titres */
  h1 {
    color: #A76F6F;
    text-align: center;
    margin-bottom: 20px;
  }

  h2 {
    color: #A76F6F;
    margin-top: 10px;
  }
</style>
<style>
  /* Define font family and size for the whole document */
  /* Define font family and size for the whole document */
  html {
    font-family: 'Open Sans', sans-serif;
    font-size: 16px;
  }

  /* Set a background color */
  body {
    background-color: #f2f2f2;
  }

  /* Define the sidebar */
  .my-own-container .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 220px;
    background-color: #fcfcfc;
    z-index: 1000;
    /* Set a high z-index */
  }

  .my-own-container .navbar-brand {
    background-image: url('./Capture\ d’écran\ 2023-04-09\ 033300.png');
    background-repeat: no-repeat;
    background-size: contain;
    width: 190px;
    /* set the width of your image */
    height: 50px;
    /* set the height of your image */
    display: block;
    /* make the link a block element */
    text-indent: -9999px;
    /* hide the link text */
    margin-top: 50px;
    margin-left: 16px;
  }


  /* Style the navigation */
  .my-own-container .my-nav {
    margin-top: 60px;
    text-align: center;
  }

  .my-own-container .my-nav ul {
    padding: 0;
    margin: 0;
    list-style: none;
  }


  .my-own-container .my-nav li {
    margin-bottom: 15px;
  }

  .my-own-container .my-nav a {
    display: block;
    padding: 10px;
    color: #2D3250;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .my-own-container .my-nav a:hover {
    background-color: #FC7300;
    color: #ffffff;
    text-decoration: none;
  }

  .my-own-container .my-nav .active a {
    background-color: #525151;
  }


  /* Define the main content area */
  .my-own-container .main {
    display: flex;
  }

  .my-own-container #content-container {
    position: absolute;
    top: 0;
    left: 250px;
    /* Set the left position to the width of the sidebar */
    right: 0;
    bottom: 0;
    padding: 20px;
    overflow-y: auto;
    /* Add vertical scroll if necessary */
  }

 
  /* css ouverture reclamation */
  .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    color: #fff;
    padding: 10px 20px;
    font-size: 18px;
    border-radius: 5px;
    cursor: pointer;
  }


  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }

  .btn-reclamation {
    background-color: #2D3250;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
  }

  .mm {
    margin-left: 50px;
  }

  .btn-reclamation:hover {
    background-color: #2D3250;
  }

  .btn-reclamation11 {
    background-color: #A76F6F;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
  }

  .btn-reclamation11:hover {
    background-color: #a71d2a;
  }

  .mmm {
    background-color: #FC7300;
    border-radius: 5px;
    color: #fff;
    border-color: #FC7300;
    padding: 10px;
    margin-left: 100px;
    font-size: 17px;
  }
</style>
<style>
  @import url('https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    list-style: none;
    text-decoration: none;
    font-family: 'Josefin Sans', sans-serif;
  }

  body {
    background-color: #f3f5f9;
  }

  .wrapper {
    display: flex;
    position: relative;
  }

  .wrapper .sidebar {
    width: 200px;
    height: 100%;
    background: #fbfbfd;
    padding: 30px 0px;
    position: fixed;
  }

  .wrapper .sidebar h2 {
    color: #fff;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 30px;
  }

  .wrapper .sidebar ul li {
    padding: 15px;
    border-bottom: 1px solid #2D3250;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
  }

  .wrapper .sidebar ul li a {
    color: #2D3250;
    display: block;
  }

  .wrapper .sidebar ul li a .fas {
    width: 25px;
  }

  .wrapper .sidebar ul li:hover {
    background-color: #FC7300;
  }

  .wrapper .sidebar ul li:hover a {
    color: #fff;
  }

  .wrapper .sidebar .social_media {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
  }

  .wrapper .sidebar .social_media a {
    display: block;
    width: 40px;
    background: #FC7300;
    height: 40px;
    line-height: 45px;
    text-align: center;
    margin: 0 5px;
    color: #2D3250;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
  }

  .wrapper .main_content {
    width: 100%;
    margin-left: 200px;
  }

  .wrapper .main_content .header {
    padding: 20px;
    background: #fff;
    color: #717171;
    border-bottom: 1px solid #e0e4e8;
  }

  .wrapper .main_content .info {
    margin: 20px;
    color: #717171;
    line-height: 25px;
  }

  .wrapper .main_content .info div {
    margin-bottom: 20px;
  }
</style>

<body>

  <div class="wrapper">
    <div class="sidebar">
      <h2>Sidebar</h2>
      <ul>
        <li><a style="text-decoration: none;" id="home" href="/home1"><i class="fas fa-home"></i>Accueil</a></li>
        <li><a style="text-decoration: none;" id="er" href="/eleve"><i class="fas fa-user"></i>Etudiant reclamer</a></li>
        <li><a style="text-decoration: none;"id="m" href="/matier"><i class="fas fa-address-card"></i>Matieres</a></li>
        <li><a style="text-decoration: none;"id="r" href="/r"><i class="fas fa-chart-bar"></i>Statistique</a></li>
        <li><a style="text-decoration: none;"id="table" href="/table"><i class="fas fa-table"></i>PV</a></li>
        <li><a style="text-decoration: none;"id="date_open" href="/date"><i class="fas fa-clock"></i>Ouvrir la réclamation</a></li>
        <li><a style="text-decoration: none;"id="date_prof" href="/date_prof"><i class="fas fa-clock"></i>Traitement des réclamation</a></li></ul>
        <div class="social_media">
          <li><a id="Logout" href="/log"><i class="fas fa-sign-out-alt"></i>Logout</a></li>
        </div>
  
    </div>
    
    <div class="main_content">
      <div id="content-container">
        <section class="home">
          <form class="mm" action="import" method="post">
            <h1 style="color: #000000;">Import Les Matieres</h1>
            <input class="mmm" class="choose-file" type="file" id="choose-file" name="fileInput" required>
            <label for="choose-file" class="upload-file"> liste-matier-ens</label>
            <button class="mmm" type="submit">Import</button>
          </form>
          <table class="center">
            <tr>
              <th>Code</th>
              <th>Titre </th>
              <th>Nom_Prof</th>
              <th>Email</th>
              <th>Modifier</th>
              <th>Supprimer</th>
  
            </tr>
            <% users.forEach(function(mat) { %>
              <tr>
                <td>
                  <%= mat.code %>
                </td>
                <td>
                  <%= mat.titre %>
                </td>
                <td>
                  <%= mat.professeur %>
                </td>
                <td>
                  <%= mat.email %>
                </td>
  
  
                <td><button  style="background-color: #3cc173;text-decoration:none"
                  class="pricing-button"><a href="open_edit/<%= mat.code %>"><p style="color: white;" >Modifier</p></a></button></td>
                <td><button  style="background-color: #f80303;text-decoration:none"
                  class="pricing-button"><a href="delete/<%= mat.code %>"><p style="color: white;" >Supprimer</p></a></button></td>
  
              </tr>
              <% }); %>
  
                </tr>
          </table>
        </section>
      </div>
    </div>

</body>
<script>
  $(document).ready(function () {
    var url = window.location.href;
    if (url.endsWith('/admin')) {
      loadContent('/reclamations');
    }
    // handle link clicks
    $(document).on('click', 'a', function (event) {
      event.preventDefault();
      var url = $(this).attr('href');
      loadContent(url);
      history.pushState({ url: url }, null, url);
    });

    // handle back/forward buttons
    window.addEventListener('popstate', function (event) {
      if (event.state != null) {
        loadContent(event.state.url);
      } else {
        loadContent('/reclamations');
      }
    });

    // check for hash in URL
    if (window.location.hash) {
      var hash = window.location.hash.substring(1);
      loadContent(hash);
    }
    $('#table').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/table'; // redirect the user to the logout page
    });
    $('#update').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/date_prof_update'; // redirect the user to the logout page
    });
    $('#Logout').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/log'; // redirect the user to the logout page
    });
    $('#r').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/r'; // redirect the user to the logout page
    });
    $('#er').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/eleve'; // redirect the user to the logout page
    });
    $('#et').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/eleve1'; // redirect the user to the logout page
    });
    $('#m').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/matier'; // redirect the user to the logout page
    });
    $('#Reclamations').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/eleve_prof'; // redirect the user to the logout page
    });
    $('#date_open').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/date'; // redirect the user to the logout page
    });
    $('#matieres').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/matierr'; // redirect the user to the logout page
    });
    $('#date_prof').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/date_prof'; // redirect the user to the logout page
    });
    $('#env').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/env_reclamation'; // redirect the user to the logout page
    }); $('#home').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/home1'; // redirect the user to the logout page
    });
    $('#rec').click(function (e) {
      e.preventDefault(); // prevent the default click behavior
      window.location.href = '/reclamation'; // redirect the user to the logout page
    });
  });

  function loadContent(url) {
    $("#content-container").load(url);
  }
</script>
<script>
  let currentMatiereIndex = -1; // Variable pour stocker l'index de la matière en cours d'édition
  let currentMatiereCode = ""; // Variable pour stocker le code de la matière en cours d'édition

  function openModal(matricule, code, NCC, NSR, NSN, semestre, filiere, niveau, annee) {
    console.log("Matricule:", matricule);
    console.log("Code:", code);
    console.log("NCC:", NCC);
    console.log("NSR:", NSR);
    console.log("NSN:", NSN);
    console.log("Semestre:", semestre);
    console.log("Filière:", filiere);
    console.log("Niveau:", niveau);
    document.getElementById("modal").style.display = "block";
    document.getElementById("matricule").innerHTML = matricule;
    document.getElementById("info-semestre").innerHTML = semestre;
    document.getElementById("info-filiere").innerHTML = filiere;
    document.getElementById("info-niveau").innerHTML = niveau;
    document.getElementById("info-annee").innerHTML = annee;


    if (NCC !== "") {
      document.getElementById("label-ncc").style.display = "block";
      document.getElementById("ncc").style.display = "block";
      document.getElementById("ncc").value = NCC;
    } else {
      document.getElementById("label-ncc").style.display = "none";
      document.getElementById("ncc").style.display = "none";
    }

    if (NSR !== "") {
      document.getElementById("label-nsr").style.display = "block";
      document.getElementById("nsr").style.display = "block";
      document.getElementById("nsr").value = NSR;
    } else {
      document.getElementById("label-nsr").style.display = "none";
      document.getElementById("nsr").style.display = "none";
    }

    if (NSN !== "") {
      document.getElementById("label-nsn").style.display = "block";
      document.getElementById("nsn").style.display = "block";
      document.getElementById("nsn").value = NSN;
    } else {
      document.getElementById("label-nsn").style.display = "none";
      document.getElementById("nsn").style.display = "none";
    }

    currentMatiereCode = code;

    // Stocker l'index de la matière en cours d'édition
    const donneeIndex = data.findIndex(donnee => donnee.matricule === matricule);
    currentMatiereIndex = donneeIndex >= 0 ? donneeIndex : -1;
    currentMatiereCode = currentMatiereIndex >= 0 ? data[currentMatiereIndex].reclamations[currentMatiereIndex].code : "";
  }


  function closeModal() {
    const modal = document.getElementById("modal");
    modal.style.display = "none";
  }

  function showConfirmationModal() {
    const confirmationModal = document.getElementById("confirmationModal");
    confirmationModal.style.display = "block";
  }

  function closeConfirmationModal() {
    const confirmationModal = document.getElementById("confirmationModal");
    if (confirmationModal && confirmationModal.style.display !== "none") {
      confirmationModal.style.display = "none";
    }
  }

  function SubmitForm() {
    const matricule = document.getElementById("matricule").innerText;
    const semestre = document.getElementById("info-semestre").innerText;
    const filiere = document.getElementById("info-filiere").innerText;


    const niveau = document.getElementById("info-niveau").innerText;
    const annee = document.getElementById("info-annee").innerText;


    const nccValue = document.getElementById("ncc").value;
    const nsrValue = document.getElementById("nsr").value;
    const nsnValue = document.getElementById("nsn").value;
    const repondreValue = document.getElementById("reponse").value;

    // Créer un objet contenant les données à envoyer
    const formData = {
      matricule: matricule,
      code: currentMatiereCode,
      annee: annee,
      ncc: nccValue,
      nsr: nsrValue,
      nsn: nsnValue,
      semestre: semestre,
      filiere: filiere,
      niveau: niveau,
      reponse: repondreValue,
    };
    showConfirmationModal();
  };      // Récupérer les valeurs des champs

  function confirmSubmitForm() {
    const matricule = document.getElementById("matricule").innerText;
    const semestre = document.getElementById("info-semestre").innerText;
    const filiere = document.getElementById("info-filiere").innerText;


    const niveau = document.getElementById("info-niveau").innerText;
    const annee = document.getElementById("info-annee").innerText;


    const nccValue = document.getElementById("ncc").value;
    const nsrValue = document.getElementById("nsr").value;
    const nsnValue = document.getElementById("nsn").value;
    const repondreValue = document.getElementById("reponse").value;

    // Créer un objet contenant les données à envoyer
    const formData = {
      matricule: matricule,
      code: currentMatiereCode,
      annee: annee,
      ncc: nccValue,
      nsr: nsrValue,
      nsn: nsnValue,
      semestre: semestre,
      filiere: filiere,
      niveau: niveau,
      reponse: repondreValue,
    };

    closeConfirmationModal();
    closeModal();
    fetch('/modifier_reclamation', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
      .then(response => response.text())
      .then(data => {
        console.log(data); // Afficher la réponse du serveur
        closeConfirmationModal(); // Fermer le modal principal après la modification

        // Mettre à jour les données dans le tableau data
        if (currentMatiereIndex >= 0) {
          data[currentMatiereIndex].reclamations[currentMatiereIndex].NCC = formData.ncc;
          data[currentMatiereIndex].reclamations[currentMatiereIndex].NSR = formData.nsr;
          data[currentMatiereIndex].reclamations[currentMatiereIndex].NSN = formData.nsn;
          data[currentMatiereIndex].reclamations[currentMatiereIndex].reponse = formData.reponse;
        }

        // Afficher l'alerte avec le message personnalisé
        showAlert('Les données ont été enregistrées avec succès.', 'success');
      })
      .catch(error => {
        console.error('Erreur lors de la modification de la réclamation:', error);
      })
      .finally(() => {
        closeConfirmationModal(); // Fermer le modal de confirmation
      });

  }


  // Afficher le modal de confirmation


  // Effectuer la requête AJAX vers la route de modification

  function showAlert(message, type) {
    const alertElement = document.createElement('div');
    alertElement.classList.add('alert');
    alertElement.classList.add(`alert-${type}`);
    alertElement.textContent = message;

    const closeButton = document.createElement('a');
    closeButton.classList.add('alert-close');
    closeButton.innerHTML = '&times;';
    closeButton.href = '#';
    closeButton.addEventListener('click', function () {
      this.parentElement.remove();
    });

    alertElement.appendChild(closeButton);

    document.body.appendChild(alertElement);
  }


</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>

</html>